using CineWaifu.Abstractions;
using CineWaifu.Abstractions.Enum;
using CineWaifu.Domain.Extensions;
using CineWaifu.Domain.Model.Color;

namespace CineWaifu.Domain.Calculators
{
    public class RgbAnsiColorMapper : IAnsiColorMapper<RgbColor>
    {
        public RgbAnsiColorMapper(IDistanceProvider distanceProvider)
        {
            _distanceProvider = distanceProvider;
        }

        public AnsiColor GetClosestAnsiColor(RgbColor rgbColor)
        {
            LabColor currentLabColor = rgbColor.ToLab();
            double minDistance = double.MaxValue;
            AnsiColor closestColor = default;

            foreach (KeyValuePair<AnsiColor, LabColor> color in _colors.Value)
            {
                LabColor mapLabColor = color.Value;

                double distance = _distanceProvider.Calculate(mapLabColor, currentLabColor);

                if (distance < minDistance)
                {
                    minDistance = distance;
                    closestColor = color.Key;
                }
            }
            return closestColor;
        }

        private readonly Lazy<IDictionary<AnsiColor, LabColor>> _colors = new Lazy<IDictionary<AnsiColor, LabColor>>(BuildAnsiColors, true);

        private static IDictionary<AnsiColor, LabColor> BuildAnsiColors()
        {
            return new Dictionary<AnsiColor, LabColor>()
            {
                { AnsiColor.Black, new RgbColor(0, 0, 0).ToLab() },
                { AnsiColor.Red, new RgbColor(205, 0, 0).ToLab() },
                { AnsiColor.Green, new RgbColor(0, 205, 0).ToLab() },
                { AnsiColor.Yellow, new RgbColor(205, 205, 0).ToLab() },
                { AnsiColor.Blue, new RgbColor(0, 0, 205).ToLab() },
                { AnsiColor.Magenta, new RgbColor(205, 0, 205).ToLab() },
                { AnsiColor.Cyan, new RgbColor(0, 205, 205).ToLab() },
                { AnsiColor.White, new RgbColor(229, 229, 229).ToLab() },
                { AnsiColor.Gray, new RgbColor(127, 127, 127).ToLab() },
                { AnsiColor.BrightRed, new RgbColor(255, 85, 85).ToLab() },
                { AnsiColor.BrightGreen, new RgbColor(85, 255, 85).ToLab() },
                { AnsiColor.BrightYellow, new RgbColor(255, 255, 85).ToLab() },
                { AnsiColor.BrightBlue, new RgbColor(85, 85, 255).ToLab() },
                { AnsiColor.BrightMagenta, new RgbColor(255, 85, 255).ToLab() },
                { AnsiColor.BrightCyan, new RgbColor(85, 255, 255).ToLab() },
                { AnsiColor.BrightWhite, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color16, new RgbColor(0, 0, 0).ToLab() },
                { AnsiColor.Color17, new RgbColor(0, 0, 95).ToLab() },
                { AnsiColor.Color18, new RgbColor(0, 0, 135).ToLab() },
                { AnsiColor.Color19, new RgbColor(0, 0, 175).ToLab() },
                { AnsiColor.Color20, new RgbColor(0, 0, 215).ToLab() },
                { AnsiColor.Color21, new RgbColor(0, 0, 255).ToLab() },
                { AnsiColor.Color22, new RgbColor(0, 95, 0).ToLab() },
                { AnsiColor.Color23, new RgbColor(0, 95, 95).ToLab() },
                { AnsiColor.Color24, new RgbColor(0, 95, 135).ToLab() },
                { AnsiColor.Color25, new RgbColor(0, 95, 175).ToLab() },
                { AnsiColor.Color26, new RgbColor(0, 95, 215).ToLab() },
                { AnsiColor.Color27, new RgbColor(0, 95, 255).ToLab() },
                { AnsiColor.Color28, new RgbColor(0, 135, 0).ToLab() },
                { AnsiColor.Color29, new RgbColor(0, 135, 95).ToLab() },
                { AnsiColor.Color30, new RgbColor(0, 135, 135).ToLab() },
                { AnsiColor.Color31, new RgbColor(0, 135, 175).ToLab() },
                { AnsiColor.Color32, new RgbColor(0, 135, 215).ToLab() },
                { AnsiColor.Color33, new RgbColor(0, 135, 255).ToLab() },
                { AnsiColor.Color34, new RgbColor(0, 175, 0).ToLab() },
                { AnsiColor.Color35, new RgbColor(0, 175, 95).ToLab() },
                { AnsiColor.Color36, new RgbColor(0, 175, 135).ToLab() },
                { AnsiColor.Color37, new RgbColor(0, 175, 175).ToLab() },
                { AnsiColor.Color38, new RgbColor(0, 175, 215).ToLab() },
                { AnsiColor.Color39, new RgbColor(0, 175, 255).ToLab() },
                { AnsiColor.Color40, new RgbColor(0, 215, 0).ToLab() },
                { AnsiColor.Color41, new RgbColor(0, 215, 95).ToLab() },
                { AnsiColor.Color42, new RgbColor(0, 215, 135).ToLab() },
                { AnsiColor.Color43, new RgbColor(0, 215, 175).ToLab() },
                { AnsiColor.Color44, new RgbColor(0, 215, 215).ToLab() },
                { AnsiColor.Color45, new RgbColor(0, 215, 255).ToLab() },
                { AnsiColor.Color46, new RgbColor(0, 255, 0).ToLab() },
                { AnsiColor.Color47, new RgbColor(0, 255, 95).ToLab() },
                { AnsiColor.Color48, new RgbColor(0, 255, 135).ToLab() },
                { AnsiColor.Color49, new RgbColor(0, 255, 175).ToLab() },
                { AnsiColor.Color50, new RgbColor(0, 255, 215).ToLab() },
                { AnsiColor.Color51, new RgbColor(0, 255, 255).ToLab() },
                { AnsiColor.Color52, new RgbColor(95, 0, 0).ToLab() },
                { AnsiColor.Color53, new RgbColor(95, 0, 95).ToLab() },
                { AnsiColor.Color54, new RgbColor(95, 0, 135).ToLab() },
                { AnsiColor.Color55, new RgbColor(95, 0, 175).ToLab() },
                { AnsiColor.Color56, new RgbColor(95, 0, 215).ToLab() },
                { AnsiColor.Color57, new RgbColor(95, 0, 255).ToLab() },
                { AnsiColor.Color58, new RgbColor(95, 95, 0).ToLab() },
                { AnsiColor.Color59, new RgbColor(95, 95, 95).ToLab() },
                { AnsiColor.Color60, new RgbColor(95, 95, 135).ToLab() },
                { AnsiColor.Color61, new RgbColor(95, 95, 175).ToLab() },
                { AnsiColor.Color62, new RgbColor(95, 95, 215).ToLab() },
                { AnsiColor.Color63, new RgbColor(95, 95, 255).ToLab() },
                { AnsiColor.Color64, new RgbColor(95, 135, 0).ToLab() },
                { AnsiColor.Color65, new RgbColor(95, 135, 95).ToLab() },
                { AnsiColor.Color66, new RgbColor(95, 135, 135).ToLab() },
                { AnsiColor.Color67, new RgbColor(95, 135, 175).ToLab() },
                { AnsiColor.Color68, new RgbColor(95, 135, 215).ToLab() },
                { AnsiColor.Color69, new RgbColor(95, 135, 255).ToLab() },
                { AnsiColor.Color70, new RgbColor(95, 175, 0).ToLab() },
                { AnsiColor.Color71, new RgbColor(95, 175, 95).ToLab() },
                { AnsiColor.Color72, new RgbColor(95, 175, 135).ToLab() },
                { AnsiColor.Color73, new RgbColor(95, 175, 175).ToLab() },
                { AnsiColor.Color74, new RgbColor(95, 175, 215).ToLab() },
                { AnsiColor.Color75, new RgbColor(95, 175, 255).ToLab() },
                { AnsiColor.Color76, new RgbColor(95, 215, 0).ToLab() },
                { AnsiColor.Color77, new RgbColor(95, 215, 95).ToLab() },
                { AnsiColor.Color78, new RgbColor(95, 215, 135).ToLab() },
                { AnsiColor.Color79, new RgbColor(95, 215, 175).ToLab() },
                { AnsiColor.Color80, new RgbColor(95, 215, 215).ToLab() },
                { AnsiColor.Color81, new RgbColor(95, 215, 255).ToLab() },
                { AnsiColor.Color82, new RgbColor(95, 255, 0).ToLab() },
                { AnsiColor.Color83, new RgbColor(95, 255, 95).ToLab() },
                { AnsiColor.Color84, new RgbColor(95, 255, 135).ToLab() },
                { AnsiColor.Color85, new RgbColor(95, 255, 175).ToLab() },
                { AnsiColor.Color86, new RgbColor(95, 255, 215).ToLab() },
                { AnsiColor.Color87, new RgbColor(95, 255, 255).ToLab() },
                { AnsiColor.Color88, new RgbColor(135, 0, 0).ToLab() },
                { AnsiColor.Color89, new RgbColor(135, 0, 95).ToLab() },
                { AnsiColor.Color90, new RgbColor(135, 0, 135).ToLab() },
                { AnsiColor.Color91, new RgbColor(135, 0, 175).ToLab() },
                { AnsiColor.Color92, new RgbColor(135, 0, 215).ToLab() },
                { AnsiColor.Color93, new RgbColor(135, 0, 255).ToLab() },
                { AnsiColor.Color94, new RgbColor(135, 95, 0).ToLab() },
                { AnsiColor.Color95, new RgbColor(135, 95, 95).ToLab() },
                { AnsiColor.Color96, new RgbColor(135, 95, 135).ToLab() },
                { AnsiColor.Color97, new RgbColor(135, 95, 175).ToLab() },
                { AnsiColor.Color98, new RgbColor(135, 95, 215).ToLab() },
                { AnsiColor.Color99, new RgbColor(135, 95, 255).ToLab() },
                { AnsiColor.Color100, new RgbColor(135, 135, 0).ToLab() },
                { AnsiColor.Color101, new RgbColor(135, 135, 95).ToLab() },
                { AnsiColor.Color102, new RgbColor(135, 135, 135).ToLab() },
                { AnsiColor.Color103, new RgbColor(135, 135, 175).ToLab() },
                { AnsiColor.Color104, new RgbColor(135, 135, 215).ToLab() },
                { AnsiColor.Color105, new RgbColor(135, 135, 255).ToLab() },
                { AnsiColor.Color106, new RgbColor(135, 175, 0).ToLab() },
                { AnsiColor.Color107, new RgbColor(135, 175, 95).ToLab() },
                { AnsiColor.Color108, new RgbColor(135, 175, 135).ToLab() },
                { AnsiColor.Color109, new RgbColor(135, 175, 175).ToLab() },
                { AnsiColor.Color110, new RgbColor(135, 175, 215).ToLab() },
                { AnsiColor.Color111, new RgbColor(135, 175, 255).ToLab() },
                { AnsiColor.Color112, new RgbColor(135, 215, 0).ToLab() },
                { AnsiColor.Color113, new RgbColor(135, 215, 95).ToLab() },
                { AnsiColor.Color114, new RgbColor(135, 215, 135).ToLab() },
                { AnsiColor.Color115, new RgbColor(135, 215, 175).ToLab() },
                { AnsiColor.Color116, new RgbColor(135, 215, 215).ToLab() },
                { AnsiColor.Color117, new RgbColor(135, 215, 255).ToLab() },
                { AnsiColor.Color118, new RgbColor(135, 255, 0).ToLab() },
                { AnsiColor.Color119, new RgbColor(135, 255, 95).ToLab() },
                { AnsiColor.Color120, new RgbColor(135, 255, 135).ToLab() },
                { AnsiColor.Color121, new RgbColor(135, 255, 175).ToLab() },
                { AnsiColor.Color122, new RgbColor(135, 255, 215).ToLab() },
                { AnsiColor.Color123, new RgbColor(135, 255, 255).ToLab() },
                { AnsiColor.Color124, new RgbColor(175, 0, 0).ToLab() },
                { AnsiColor.Color125, new RgbColor(175, 0, 95).ToLab() },
                { AnsiColor.Color126, new RgbColor(175, 0, 135).ToLab() },
                { AnsiColor.Color127, new RgbColor(175, 0, 175).ToLab() },
                { AnsiColor.Color128, new RgbColor(175, 0, 215).ToLab() },
                { AnsiColor.Color129, new RgbColor(175, 0, 255).ToLab() },
                { AnsiColor.Color130, new RgbColor(175, 95, 0).ToLab() },
                { AnsiColor.Color131, new RgbColor(175, 95, 95).ToLab() },
                { AnsiColor.Color132, new RgbColor(175, 95, 135).ToLab() },
                { AnsiColor.Color133, new RgbColor(175, 95, 175).ToLab() },
                { AnsiColor.Color134, new RgbColor(175, 95, 215).ToLab() },
                { AnsiColor.Color135, new RgbColor(175, 95, 255).ToLab() },
                { AnsiColor.Color136, new RgbColor(175, 135, 0).ToLab() },
                { AnsiColor.Color137, new RgbColor(175, 135, 95).ToLab() },
                { AnsiColor.Color138, new RgbColor(175, 135, 135).ToLab() },
                { AnsiColor.Color139, new RgbColor(175, 135, 175).ToLab() },
                { AnsiColor.Color140, new RgbColor(175, 135, 215).ToLab() },
                { AnsiColor.Color141, new RgbColor(175, 135, 255).ToLab() },
                { AnsiColor.Color142, new RgbColor(175, 175, 0).ToLab() },
                { AnsiColor.Color143, new RgbColor(175, 175, 95).ToLab() },
                { AnsiColor.Color144, new RgbColor(175, 175, 135).ToLab() },
                { AnsiColor.Color145, new RgbColor(175, 175, 175).ToLab() },
                { AnsiColor.Color146, new RgbColor(175, 175, 215).ToLab() },
                { AnsiColor.Color147, new RgbColor(175, 175, 255).ToLab() },
                { AnsiColor.Color148, new RgbColor(175, 215, 0).ToLab() },
                { AnsiColor.Color149, new RgbColor(175, 215, 95).ToLab() },
                { AnsiColor.Color150, new RgbColor(175, 215, 135).ToLab() },
                { AnsiColor.Color151, new RgbColor(175, 215, 175).ToLab() },
                { AnsiColor.Color152, new RgbColor(175, 215, 215).ToLab() },
                { AnsiColor.Color153, new RgbColor(175, 215, 255).ToLab() },
                { AnsiColor.Color154, new RgbColor(175, 255, 0).ToLab() },
                { AnsiColor.Color155, new RgbColor(175, 255, 95).ToLab() },
                { AnsiColor.Color156, new RgbColor(175, 255, 135).ToLab() },
                { AnsiColor.Color157, new RgbColor(175, 255, 175).ToLab() },
                { AnsiColor.Color158, new RgbColor(175, 255, 215).ToLab() },
                { AnsiColor.Color159, new RgbColor(175, 255, 255).ToLab() },
                { AnsiColor.Color160, new RgbColor(215, 0, 0).ToLab() },
                { AnsiColor.Color161, new RgbColor(215, 0, 95).ToLab() },
                { AnsiColor.Color162, new RgbColor(215, 0, 135).ToLab() },
                { AnsiColor.Color163, new RgbColor(215, 0, 175).ToLab() },
                { AnsiColor.Color164, new RgbColor(215, 0, 215).ToLab() },
                { AnsiColor.Color165, new RgbColor(215, 0, 255).ToLab() },
                { AnsiColor.Color166, new RgbColor(215, 95, 0).ToLab() },
                { AnsiColor.Color167, new RgbColor(215, 95, 95).ToLab() },
                { AnsiColor.Color168, new RgbColor(215, 95, 135).ToLab() },
                { AnsiColor.Color169, new RgbColor(215, 95, 175).ToLab() },
                { AnsiColor.Color170, new RgbColor(215, 95, 215).ToLab() },
                { AnsiColor.Color171, new RgbColor(215, 95, 255).ToLab() },
                { AnsiColor.Color172, new RgbColor(215, 135, 0).ToLab() },
                { AnsiColor.Color173, new RgbColor(215, 135, 95).ToLab() },
                { AnsiColor.Color174, new RgbColor(215, 135, 135).ToLab() },
                { AnsiColor.Color175, new RgbColor(215, 135, 175).ToLab() },
                { AnsiColor.Color176, new RgbColor(215, 135, 215).ToLab() },
                { AnsiColor.Color177, new RgbColor(215, 135, 255).ToLab() },
                { AnsiColor.Color178, new RgbColor(215, 175, 0).ToLab() },
                { AnsiColor.Color179, new RgbColor(215, 175, 95).ToLab() },
                { AnsiColor.Color180, new RgbColor(215, 175, 135).ToLab() },
                { AnsiColor.Color181, new RgbColor(215, 175, 175).ToLab() },
                { AnsiColor.Color182, new RgbColor(215, 175, 215).ToLab() },
                { AnsiColor.Color183, new RgbColor(215, 175, 255).ToLab() },
                { AnsiColor.Color184, new RgbColor(215, 215, 0).ToLab() },
                { AnsiColor.Color185, new RgbColor(215, 215, 95).ToLab() },
                { AnsiColor.Color186, new RgbColor(215, 215, 135).ToLab() },
                { AnsiColor.Color187, new RgbColor(215, 215, 175).ToLab() },
                { AnsiColor.Color188, new RgbColor(215, 215, 215).ToLab() },
                { AnsiColor.Color189, new RgbColor(215, 215, 255).ToLab() },
                { AnsiColor.Color190, new RgbColor(215, 255, 0).ToLab() },
                { AnsiColor.Color191, new RgbColor(215, 255, 95).ToLab() },
                { AnsiColor.Color192, new RgbColor(215, 255, 135).ToLab() },
                { AnsiColor.Color193, new RgbColor(215, 255, 175).ToLab() },
                { AnsiColor.Color194, new RgbColor(215, 255, 215).ToLab() },
                { AnsiColor.Color195, new RgbColor(215, 255, 255).ToLab() },
                { AnsiColor.Color196, new RgbColor(255, 0, 0).ToLab() },
                { AnsiColor.Color197, new RgbColor(255, 0, 95).ToLab() },
                { AnsiColor.Color198, new RgbColor(255, 0, 135).ToLab() },
                { AnsiColor.Color199, new RgbColor(255, 0, 175).ToLab() },
                { AnsiColor.Color200, new RgbColor(255, 0, 215).ToLab() },
                { AnsiColor.Color201, new RgbColor(255, 0, 255).ToLab() },
                { AnsiColor.Color202, new RgbColor(255, 95, 0).ToLab() },
                { AnsiColor.Color203, new RgbColor(255, 95, 95).ToLab() },
                { AnsiColor.Color204, new RgbColor(255, 95, 135).ToLab() },
                { AnsiColor.Color205, new RgbColor(255, 95, 175).ToLab() },
                { AnsiColor.Color206, new RgbColor(255, 95, 215).ToLab() },
                { AnsiColor.Color207, new RgbColor(255, 95, 255).ToLab() },
                { AnsiColor.Color208, new RgbColor(255, 135, 0).ToLab() },
                { AnsiColor.Color209, new RgbColor(255, 135, 95).ToLab() },
                { AnsiColor.Color210, new RgbColor(255, 135, 135).ToLab() },
                { AnsiColor.Color211, new RgbColor(255, 135, 175).ToLab() },
                { AnsiColor.Color212, new RgbColor(255, 135, 215).ToLab() },
                { AnsiColor.Color213, new RgbColor(255, 135, 255).ToLab() },
                { AnsiColor.Color214, new RgbColor(255, 175, 0).ToLab() },
                { AnsiColor.Color215, new RgbColor(255, 175, 95).ToLab() },
                { AnsiColor.Color216, new RgbColor(255, 175, 135).ToLab() },
                { AnsiColor.Color217, new RgbColor(255, 175, 175).ToLab() },
                { AnsiColor.Color218, new RgbColor(255, 175, 215).ToLab() },
                { AnsiColor.Color219, new RgbColor(255, 175, 255).ToLab() },
                { AnsiColor.Color220, new RgbColor(255, 215, 0).ToLab() },
                { AnsiColor.Color221, new RgbColor(255, 215, 95).ToLab() },
                { AnsiColor.Color222, new RgbColor(255, 215, 135).ToLab() },
                { AnsiColor.Color223, new RgbColor(255, 215, 175).ToLab() },
                { AnsiColor.Color224, new RgbColor(255, 215, 215).ToLab() },
                { AnsiColor.Color225, new RgbColor(255, 215, 255).ToLab() },
                { AnsiColor.Color226, new RgbColor(255, 255, 0).ToLab() },
                { AnsiColor.Color227, new RgbColor(255, 255, 95).ToLab() },
                { AnsiColor.Color228, new RgbColor(255, 255, 135).ToLab() },
                { AnsiColor.Color229, new RgbColor(255, 255, 175).ToLab() },
                { AnsiColor.Color230, new RgbColor(255, 255, 215).ToLab() },
                { AnsiColor.Color231, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color232, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color233, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color234, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color235, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color236, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color237, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color238, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color239, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color240, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color241, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color242, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color243, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color244, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color245, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color246, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color247, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color248, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color249, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color250, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color251, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color252, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color253, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color254, new RgbColor(255, 255, 255).ToLab() },
                { AnsiColor.Color255, new RgbColor(255, 255, 255).ToLab() },
            };
        }

        private readonly IDistanceProvider _distanceProvider;
    }
}
